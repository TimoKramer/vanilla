{"version":3,"sources":["webpack://vanilla-forum/./packages/vanilla-utils/src/fileUtils.ts","webpack://vanilla-forum/./packages/vanilla-utils/src/mathUtils.ts","webpack://vanilla-forum/./packages/vanilla-utils/src/stringUtils.ts","webpack://vanilla-forum/./packages/vanilla-utils/src/systemUtils.ts","webpack://vanilla-forum/./packages/vanilla-utils/src/typeUtils.ts","webpack://vanilla-forum/./packages/vanilla-utils/index.ts","webpack://vanilla-forum/./node_modules/moment/locale sync en","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/domData.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/emoji.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/EscapeListener.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/events.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/FocusWatcher.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/sanitization.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/scripts.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/shadowDom.tsx","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/TabHandler.ts","webpack://vanilla-forum/./packages/vanilla-dom-utils/src/index.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/Hoverable.tsx","webpack://vanilla-forum/./packages/vanilla-react-utils/src/mounting.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/useEscapeListener.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/useFocusWatcher.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/useMeasure.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/useLastValue.tsx","webpack://vanilla-forum/./packages/vanilla-react-utils/src/useThrowError.ts","webpack://vanilla-forum/./packages/vanilla-react-utils/src/index.ts","webpack://vanilla-forum/./packages/vanilla-utils/src/debugUtils.ts","webpack://vanilla-forum/./library/src/scripts/forms/TextInput.tsx","webpack://vanilla-forum/./library/src/scripts/pageViews/pageViewTracking.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/atMentionStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/accessibilityStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/blockQuoteStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/emojiStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/spoilerStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/codeBlockStyles.ts","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/loadedStyles.ts","webpack://vanilla-forum/./library/src/scripts/locales/localeBootstrap.ts","webpack://vanilla-forum/./library/src/scripts/bootstrap.ts","webpack://vanilla-forum/./library/src/scripts/forms/mountInputs.tsx","webpack://vanilla-forum/./plugins/rich-editor/src/scripts/quill/components/blotStyles.ts","webpack://vanilla-forum/./packages/vanilla-i18n/src/localeStore.ts","webpack://vanilla-forum/./packages/vanilla-i18n/src/LocaleProvider.tsx","webpack://vanilla-forum/./packages/vanilla-i18n/src/translationStore.ts","webpack://vanilla-forum/./packages/vanilla-i18n/src/index.ts","webpack://vanilla-forum/./build/entries/public-path.ts"],"names":["IMAGE_REGEX","isFileImage","file","test","type","logDebug","name","simplifyFraction","numerator","denominator","gcd","findGCD","a","b","shorthand","hashString","str","split","reduce","prevHash","currVal","charCodeAt","slugify","options","whiteSpaceNormalizeRegexp","allowMultipleDashes","normalize","replace","trim","toLocaleLowerCase","splitStringLoosely","toSplit","splitWith","normalizedName","normalizedSplitTerm","normalizedPieces","RegExp","charactersUsed","map","piece","start","length","substring","matchAtMention","subtext","shouldStartWithSpace","requireQuotesForWhitespace","lines","lastLine","nonExcludedCharacters","excludeWhiteSpace","excluded","regexStr","match","exec","rawMatch","OS","SAFE_PROTOCOL_REGEX","sanitizeUrl","url","indexArrayByKey","array","key","object","item","push","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","dataMap","WeakMap","setData","element","value","initialValue","has","get","set","getData","defaultValue","attributeString","hasAttribute","getAttribute","emojiSupportedCache","isEmojiSupported","canvas","document","createElement","getContext","ctx","fillText","getImageData","data","emojiOptions","className","size","convertToSafeEmojiCharacters","stringOrNode","twemoji","parse","EscapeListener","root","returnElement","callback","addEventListener","keydownListener","removeEventListener","event","contains","activeElement","preventDefault","focus","delegatedEventListeners","delegateEvent","eventName","filterSelector","scopeSelector","scope","functionKey","toString","querySelector","HTMLElement","eventHash","includes","wrappedCallback","target","closest","call","removeDelegatedEvent","getDraggedFile","dataTransfer","files","getPastedFile","clipboardData","items","Array","from","getAsFile","filter","Boolean","FocusWatcher","rootNode","changeHandler","handleFocusOut","handleFocusIn","handleClick","checkDomTreeHasFocus","triggeringElement","checkDomTreeWasClicked","clickedElement","this","setTimeout","relatedTarget","explicitOriginalTarget","body","hasFocus","escapeHTML","div","appendChild","createTextNode","innerHTML","ensureHtmlElement","selectorOrElement","loadEventCallbacks","rejectionCache","Map","ensureScript","scriptUrl","Promise","reject","existingScript","callbacks","head","getElementsByTagName","script","src","onerror","error","timeout","onload","clearTimeout","forEach","delete","prepareShadowRoot","cloneElement","newElementTag","html","ns","append","result","startsWith","remove","browserEscapesNoScript","escapedString","child","childNodes","nodeValue","unescapeHTML","newElement","classList","parentNode","insertBefore","attachShadow","mode","TabHandler","documentElement","excludedElements","excludedRoots","exemption","elementToFilter","excludedRoot","tabbableElements","tabbable","reverse","allowLooping","logError","tabbables","createExcludeFilterWithExemption","currentTabIndex","indexOf","targetIndex","filterAllExcluded","smoothscroll","polyfill","Hoverable","hasExecuted","props","once","onHover","hoverTimeout","handleHover","duration","dismissTimeout","children","onMouseEnter","mouseEnterHandler","onMouseLeave","mouseLeaveHandler","React","Component","mountReact","component","cleanupContainer","mountPoint","overwrite","container","parentElement","ReactDOM","render","firstElementChild","forceRenderStyles","useEscapeListener","useEffect","actualRoot","escapeListener","stop","useFocusWatcher","ref","bypass","useLayoutEffect","current","focusWatcher","useMeasure","useState","x","y","width","height","top","right","bottom","left","toJSON","bounds","setContentRect","animationFrameId","ro","ResizeObserver","window","requestAnimationFrame","getBoundingClientRect","observe","cancelAnimationFrame","disconnect","useLastValue","useRef","useThrowError","setError","internalDebugValue","debug","newValue","undefined","console","log","logWarning","warn","InputStyle","InputValidationFilter","TextInput","inputStyle","validationFilter","onChange","inputRef","rest","ownValue","setOwnValue","actualValue","actualOnChange","useCallback","filterMethod","filterMode","NUMBER","SLUG","getFilterMethodForMode","inputType","getInputType","classes","classNames","DASHBOARD","inputClasses","text","handlers","atMentionVariables","useThemeCache","globalVars","globalVariables","makeThemeVars","variableFactory","font","fonts","large","avatar","margin","positioning","offset","mark","weight","weights","semiBold","link","user","padding","vertical","horizontal","selected","bg","mainColors","sizing","maxHeight","atMentionCSS","vars","cssRule","position","unit","transform","singleLineEllipsis","appearance","border","background","percent","textAlign","$nest","display","paddings","overflow","marginBottom","backgroundColor","colorOut","states","color","cursor","alignItems","boxSizing","lineHeight","marginRight","flexGrow","whiteSpace","textOverflow","maxWidth","calc","fontWeight","userSelect","accessibilityCSS","clip","elementaryColors","white","black","fontSize","medium","zIndex","opacity","blockQuoteVariables","colors","fg","mixBgAndFg","blockQuoteCSS","all","borderLeft","singleBorder","verticalAlign","marginTop","emojiCSS","fontFamily","em","margins","icon","spoilerVariables","borders","radius","button","transparent","spoilerCSS","spoilerStyles","generateButtonStyleProperties","userContentVars","userContentVariables","sizes","default","blocks","embed","minHeight","textTransform","outline","justifyContent","absolutePosition","middleRightOfParent","marginLeft","codeBlockVariables","borderRadius","families","variablesUserContent","inline","codeInline","block","codeBlock","userContent","codeBlockCSS","overflowX","flexShrink","wordWrap","lineHeights","loadedCSS","visibility","important","currentLocaleValue","getMeta","setCurrentLocale","fetchLocalesFromApi","locales","loadLocales","loadTranslations","gdn","translations","handler","debugValue","bootstrapLocales","apiv2","params","post","then","dispatchEvent","CustomEvent","_executeReady","onContent","inputs","_mountComponents","querySelectorAll","input","HTMLInputElement","contentEvent","bubbles","cancelable","catch","currentLocale","localeStore","getLocales","localeKey","getCurrentLocale","LocaleContext","createContext","LocaleProvider","setLocales","Provider","translationStore","translate","defaultTranslation","substr","t","__webpack_public_path__","assetUrl"],"mappings":"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","file":"bootstrap.min.js?684f106a43f6d9a99ed7","sourcesContent":["/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { logDebug } from \"./debugUtils\";\n\n/** This should mirror extensions allowed in Vanilla\\ImageResizer.php */\nconst IMAGE_REGEX = /^image\\/(gif|jpe?g|png)/i;\n\n/**\n * A filter for use with [].filter\n *\n * Matches only image image type files.\n * @private\n *\n * @param file - A File object.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/File\n *\n * @returns Whether or not the file is an acceptable image\n */\nexport function isFileImage(file: File): boolean {\n    if (IMAGE_REGEX.test(file.type)) {\n        return true;\n    }\n\n    logDebug(\"Filtered out non-image file: \", file.name);\n    return false;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * Get various information about a fraction.\n *\n * @param numerator The fraction numerator.\n * @param denominator The fraction denominator.\n */\nexport function simplifyFraction(numerator: number, denominator: number) {\n    const findGCD = (a, b) => {\n        return b ? findGCD(b, a % b) : a;\n    };\n    const gcd = findGCD(numerator, denominator);\n\n    numerator = numerator / gcd;\n    denominator = denominator / gcd;\n\n    return {\n        numerator,\n        denominator,\n        shorthand: denominator + \":\" + numerator,\n    };\n}\n","/**\n * Utilities related to strings.\n *\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * A simple, fast method of hashing a string. Similar to Java's hash function.\n * https://stackoverflow.com/a/7616484/1486603\n *\n * @param str - The string to hash.\n *\n * @returns The hash code returned.\n */\nexport function hashString(str: string): number {\n    function hashReduce(prevHash, currVal) {\n        // tslint:disable-next-line:no-bitwise\n        return (prevHash << 5) - prevHash + currVal.charCodeAt(0);\n    }\n    return str.split(\"\").reduce(hashReduce, 0);\n}\n\ntype CompareReturn = -1 | 0 | 1;\n\n/**\n * Utility for sorting values. Similar to the <=> operator in PHP.\n *\n * @param val1 The first value to compare.\n * @param val2 The second value to compare.\n *\n * @returns -1, 0, or 1\n */\nexport function compare<T extends string | number>(val1: T, val2: T): CompareReturn {\n    if (typeof val1 === \"string\" && typeof val2 === \"string\") {\n        return val1.localeCompare(val2) as CompareReturn;\n    } else {\n        if (val1 > val2) {\n            return 1;\n        } else if (val1 < val2) {\n            return -1;\n        }\n        return 0;\n    }\n}\n\n/**\n * Parse a string into a URL friendly format.\n *\n * Eg. Why Uber isn’t spelled Über -> why-uber-isnt-spelled-uber\n *\n * @param str The string to parse.\n */\nexport function slugify(\n    str: string,\n    options?: {\n        allowMultipleDashes?: boolean;\n    },\n): string {\n    const whiteSpaceNormalizeRegexp = options && options.allowMultipleDashes ? /[\\s]+/g : /[-\\s]+/g;\n    return str\n        .normalize(\"NFD\") // Normalize accented characters into ASCII equivalents\n        .replace(/[^\\w\\s$*_+~.()'\"\\-!:@]/g, \"\") // REmove characters that don't URL encode well\n        .trim() // Trim whitespace\n        .replace(whiteSpaceNormalizeRegexp, \"-\") // Normalize whitespace\n        .toLocaleLowerCase(); // Convert to locale aware lowercase.\n}\n\n/**\n * Split a string in multiple pieces similar to String.prototype.split but ignore most acccent characters.\n *\n * This will still return pieces with accents.\n *\n * @param toSplit The string to split.\n * @param splitWith The string to split with.\n */\nexport function splitStringLoosely(toSplit: string, splitWith: string): string[] {\n    const normalizedName = toSplit.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\n    const normalizedSplitTerm = splitWith.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\n    const normalizedPieces = normalizedName.split(new RegExp(`(${normalizedSplitTerm})`, \"i\"));\n\n    let charactersUsed = 0;\n    return normalizedPieces.map(piece => {\n        const start = charactersUsed;\n        charactersUsed += piece.length;\n        return toSplit.substring(start, charactersUsed);\n    });\n}\n\ninterface IMentionMatch {\n    match: string;\n    rawMatch: string;\n}\n\n/**\n * Custom matching to allow quotation marks in the matching string as well as spaces.\n * Spaces make things more complicated.\n *\n * @param subtext - The string to be tested.\n * @param shouldStartWithSpace - Should the pattern include a test for a whitespace prefix?\n * @returns Matching string if successful.  Null on failure to match.\n */\nexport function matchAtMention(\n    subtext: string,\n    shouldStartWithSpace: boolean = false,\n    requireQuotesForWhitespace: boolean = true,\n): IMentionMatch | null {\n    // Split the string at the lines to allow for a simpler regex.\n    const lines = subtext.split(\"\\n\");\n    const lastLine = lines[lines.length - 1];\n\n    // If you change this you MUST change the regex in src/scripts/__tests__/legacy.test.js !!!\n    /**\n     * Put together the non-excluded characters.\n     *\n     * @param {boolean} excludeWhiteSpace - Whether or not to exclude whitespace characters.\n     *\n     * @returns {string} A Regex string.\n     */\n    function nonExcludedCharacters(excludeWhiteSpace) {\n        let excluded =\n            \"[^\" +\n            '\"' + // Quote character\n            \"\\\\u0000-\\\\u001f\\\\u007f-\\\\u009f\" + // Control characters\n            \"\\\\u2028\"; // Line terminator\n\n        if (excludeWhiteSpace) {\n            excluded += \"\\\\s\";\n        }\n\n        excluded += \"]\";\n        return excluded;\n    }\n\n    let regexStr =\n        \"@\" + // @ Symbol triggers the match\n        \"(\" +\n        // One or more non-greedy characters that aren't excluded. Whitespace is allowed, but a starting quote is required.\n        '\"(' +\n        nonExcludedCharacters(false) +\n        '+?)\"?' +\n        \"|\" + // Or\n        // One or more non-greedy characters that aren't exluded. Whitespace may be excluded.\n        \"(\" +\n        nonExcludedCharacters(requireQuotesForWhitespace) +\n        '+?)\"?' +\n        \")\" +\n        \"(?:\\\\n|$)\"; // Newline terminates.\n\n    // Determined by at.who library\n    if (shouldStartWithSpace) {\n        regexStr = \"(?:^|\\\\s)\" + regexStr;\n    }\n    const regex = new RegExp(regexStr, \"gi\");\n    const match = regex.exec(lastLine);\n    if (match) {\n        return {\n            rawMatch: match[0],\n            match: match[2] || match[1], // Return either of the matching groups (quoted or unquoted).\n        };\n    }\n\n    // No match\n    return null;\n}\n\nconst SAFE_PROTOCOL_REGEX = /^(http:\\/\\/|https:\\/\\/|tel:|mailto:\\/\\/|\\/)/;\n\n/**\n * Sanitize a URL to ensure that it matches a whitelist of approved url schemes. If the url does not match one of these schemes, prepend `unsafe:` before it.\n *\n * Allowed protocols\n * - \"http://\",\n * - \"https://\",\n * - \"tel:\",\n * - \"mailto://\",\n *\n * @param url The url to sanitize.\n */\nexport function sanitizeUrl(url: string) {\n    if (url.match(SAFE_PROTOCOL_REGEX)) {\n        return url;\n    } else {\n        return \"unsafe:\" + url;\n    }\n}\n\n/**\n * Capitalize the first character of a string.\n *\n * @param str The string to modify.\n */\nexport function capitalizeFirstLetter(str: string): string {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Simple utility function for waiting some duration in promise.\n *\n * @param duration The amount of time to wait.\n */\nexport function promiseTimeout(duration: number): Promise<void> {\n    return new Promise(resolve => {\n        setTimeout(resolve, duration);\n    });\n}\n","/**\n * Utilities related to the user's system.\n *\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nexport enum OS {\n    IOS = \"ios\",\n    ANDROID = \"android\",\n    UNKNOWN = \"unkwown\",\n}\n\n/**\n * Provide relatively rough detection of mobile OS.\n *\n * This is not even close to perfect but can be used to try and offer,\n * OS specific input elements for things like datetimes.\n */\nexport function guessOperatingSystem(): OS {\n    const userAgent = navigator.userAgent || navigator.vendor || window.opera;\n\n    if (/android/i.test(userAgent)) {\n        return OS.ANDROID;\n    }\n\n    // iOS detection from: http://stackoverflow.com/a/9039885/177710\n    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {\n        return OS.IOS;\n    }\n\n    return OS.UNKNOWN;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\ninterface IClass {\n    new (): any;\n}\n\n/**\n * Determine if an instance is an instance of any of the listed classes.\n *\n * @param needle The instance.\n * @param haystack The classes to check.\n */\nexport function isInstanceOfOneOf(needle: any, haystack: IClass[]) {\n    for (const classItem of haystack) {\n        if (needle instanceof classItem) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Transform an array of objects and an map of objets with a given key.\n *\n * Objects that do not contain the given key are dropped.\n *\n * @param array The array to go through.\n * @param key The key to lookup.\n */\nexport function indexArrayByKey<T extends object>(\n    array: T[],\n    key: string,\n): {\n    [key: string]: T;\n} {\n    const object = {};\n    for (const item of array) {\n        if (key in item) {\n            if (!(item[key] in object)) {\n                object[item[key]] = [];\n            }\n            object[item[key]].push(item);\n        }\n    }\n    return object;\n}\n","/**\n * General utility functions.\n * This file should have NO external dependencies other than javascript.\n *\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nexport * from \"./src/debugUtils\";\nexport * from \"./src/fileUtils\";\nexport * from \"./src/mathUtils\";\nexport * from \"./src/promiseUtils\";\nexport * from \"./src/stringUtils\";\nexport * from \"./src/systemUtils\";\nexport * from \"./src/typeUtils\";\n","var map = {\n\t\"./en-SG\": 101,\n\t\"./en-SG.js\": 101,\n\t\"./en-au\": 102,\n\t\"./en-au.js\": 102,\n\t\"./en-ca\": 103,\n\t\"./en-ca.js\": 103,\n\t\"./en-gb\": 104,\n\t\"./en-gb.js\": 104,\n\t\"./en-ie\": 105,\n\t\"./en-ie.js\": 105,\n\t\"./en-il\": 106,\n\t\"./en-il.js\": 106,\n\t\"./en-nz\": 107,\n\t\"./en-nz.js\": 107\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 168;","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * Get the form data out of a form element.\n *\n * @param formElement - The element to get the data out of.\n *\n * @returns {Object}\n */\nexport function getFormData(formElement: Node | null) {\n    if (!(formElement instanceof HTMLFormElement)) {\n        return {};\n    }\n\n    const data = new FormData(formElement) as any;\n    const result = {};\n\n    data.forEach((key, value) => {\n        result[key] = value;\n    });\n\n    return result;\n}\n\n/**\n * Toggle any attribute on an element.\n *\n * @param element - The element to toggle on.\n * @param attribute - The attribute to toggle.\n */\nexport function toggleAttribute(element: Element, attribute: string) {\n    const newValue = element.getAttribute(attribute) === \"false\";\n    element.setAttribute(attribute, newValue ? \"true\" : \"false\");\n}\n\nconst dataMap = new WeakMap();\n\n/**\n * Set a piece of data specific to a DOM Element. Similar to `$.data`.\n *\n * @param element - The DOM Element to assosciate the data with.\n * @param key - The key to assosciate the data with.\n * @param value - The value to store.\n */\nexport function setData(element: Element, key: string, value: any) {\n    const initialValue = dataMap.has(element) ? dataMap.get(element) : {};\n    initialValue[key] = value;\n\n    dataMap.set(element, initialValue);\n}\n\n/**\n * Get a piece of data specific to a DOM Element. Similar to `$.data`.\n *\n * @param element - The DOM Element to lookup.\n * @param key - The key to lookup.\n * @param defaultValue - A value to use if the element or key aren't found.\n */\nexport function getData(element: Element, key: string, defaultValue?: any) {\n    if (dataMap.has(element) && dataMap.get(element)[key]) {\n        return dataMap.get(element)[key];\n    }\n\n    const attributeString = `data-${key}`;\n\n    if (element.hasAttribute(attributeString)) {\n        return element.getAttribute(attributeString);\n    }\n\n    return defaultValue;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport twemoji from \"twemoji\";\n\nlet emojiSupportedCache: boolean | null = null;\n\n/**\n * Determine if the browser/OS combo has support for real unicode emojis.\n */\nexport function isEmojiSupported() {\n    if (emojiSupportedCache !== null) {\n        return emojiSupportedCache;\n    }\n\n    if (process.env.NODE_ENV !== \"test\") {\n        // Test environment\n        const canvas = document.createElement(\"canvas\");\n        if (canvas.getContext && canvas.getContext(\"2d\")) {\n            const ctx = document.createElement(\"canvas\").getContext(\"2d\");\n            if (ctx) {\n                ctx.fillText(\"😗\", -2, 4);\n                emojiSupportedCache = ctx.getImageData(0, 0, 1, 1).data[3] > 0;\n            } else {\n                emojiSupportedCache = false;\n            }\n        } else {\n            emojiSupportedCache = false;\n        }\n    } else {\n        emojiSupportedCache = true;\n    }\n\n    return emojiSupportedCache;\n}\n\nconst emojiOptions = {\n    className: \"fallBackEmoji\",\n    size: \"72x72\",\n};\n\n/**\n * Returns either native emoji or fallback image\n *\n * @param stringOrNode - A DOM Node or string to convert.\n */\nexport function convertToSafeEmojiCharacters(stringOrNode: string | Node) {\n    if (isEmojiSupported()) {\n        return stringOrNode;\n    }\n    return twemoji.parse(stringOrNode, emojiOptions);\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * Register an keyboard listener for the escape key.\n */\nexport class EscapeListener {\n    /**\n     * @param root - The element to watch for the escape listener in.\n     * @param returnElement - The element to return to when escape is pressed.\n     * @param callback\n     */\n    public constructor(\n        private root: HTMLElement,\n        private returnElement?: HTMLElement,\n        private callback?: (event: KeyboardEvent) => void,\n    ) {}\n\n    /**\n     * Start the listeners.\n     */\n    public start = () => {\n        this.root.addEventListener(\"keydown\", this.keydownListener);\n    };\n\n    /**\n     * Stop the listeners.\n     */\n    public stop = () => {\n        this.root.removeEventListener(\"keydown\", this.keydownListener);\n    };\n\n    /**\n     * Handler that checks for the key of an keyboard event and:\n     *\n     * - Returns focous to the element from the constructor.\n     * - Calls the optional callback.\n     */\n    private keydownListener = (event: KeyboardEvent) => {\n        if (event.key === \"Escape\") {\n            if (this.root.contains(document.activeElement)) {\n                event.preventDefault();\n                this.returnElement && this.returnElement.focus();\n                this.callback && this.callback(event);\n            }\n        }\n    };\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { hashString } from \"@vanilla/utils\";\n\nconst delegatedEventListeners = {};\n\n/**\n * Create an event listener using event delegation.\n *\n * @param eventName - The Event to listen for.\n * @param filterSelector - A CSS selector to match against.\n * @param callback - The callback function. This gets passed the fired event.\n * @param scopeSelector - And element to scope the event listener to.\n *\n * @returns The hash of the event. Save this to use removeDelegatedEvent().\n */\nexport function delegateEvent(\n    eventName: string,\n    filterSelector: string,\n    callback: (event: Event, triggeringElement: HTMLElement) => boolean | void,\n    scopeSelector?: string | HTMLElement,\n): string {\n    let functionKey = eventName + filterSelector + callback.toString();\n\n    let scope;\n\n    if (typeof scopeSelector === \"string\") {\n        scope = document.querySelector(scopeSelector);\n\n        if (!scope) {\n            throw new Error(`Unable to find element in the document for scopeSelector: ${scopeSelector}`);\n        } else {\n            functionKey += scopeSelector;\n        }\n    } else if (scopeSelector instanceof HTMLElement) {\n        scope = scopeSelector;\n    } else {\n        scope = document;\n    }\n\n    const eventHash = hashString(functionKey).toString();\n\n    if (!Object.keys(delegatedEventListeners).includes(eventHash)) {\n        const wrappedCallback = event => {\n            // Get the nearest DOMNode that matches the given selector.\n            const match = filterSelector ? event.target.closest(filterSelector) : event.target;\n\n            if (match) {\n                // Call the callback with the matching element as the context.\n                return callback.call(match, event, match);\n            }\n        };\n\n        scope.addEventListener(eventName, wrappedCallback);\n        delegatedEventListeners[eventHash] = {\n            scope,\n            eventName,\n            wrappedCallback,\n        };\n    }\n\n    return eventHash;\n}\n\n/**\n * Remove a delegated event listener.\n *\n * @param eventHash - The event hash passed from delegateEvent().\n */\nexport function removeDelegatedEvent(eventHash: string) {\n    const { scope, eventName, wrappedCallback } = delegatedEventListeners[eventHash];\n    scope.removeEventListener(eventName, wrappedCallback);\n    delete delegatedEventListeners[eventHash];\n}\n\n/**\n * Remove all delegated event listeners that have been registered.\n */\nexport function removeAllDelegatedEvents() {\n    Object.keys(delegatedEventListeners).forEach(key => {\n        removeDelegatedEvent(key);\n    });\n}\n\n/**\n * Handler for files being dragged and dropped.\n *\n * @param event - https://developer.mozilla.org/en-US/docs/Web/API/DragEvent\n */\nexport function getDraggedFile(event: DragEvent): FileList | undefined {\n    if (event.dataTransfer && event.dataTransfer.files && event.dataTransfer.files.length) {\n        event.preventDefault();\n\n        return event.dataTransfer.files;\n    }\n}\n\n/**\n * Handler for files being pasted.\n *\n * @param event - https://developer.mozilla.org/en-US/docs/Web/API/DragEvent\n */\nexport function getPastedFile(event: ClipboardEvent): File | undefined | null {\n    if (event.clipboardData && event.clipboardData.items && event.clipboardData.items.length) {\n        const files = Array.from(event.clipboardData.items)\n            .map((item: any) => (item.getAsFile ? item.getAsFile() : null))\n            .filter(Boolean);\n\n        if (files.length > 0) {\n            event.preventDefault();\n            // Currently only 1 file is supported.\n            const mainFile = files[0];\n            return mainFile;\n        }\n    }\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * Register a callback for focusin and focusin out events. The main improvement here over registering\n * the listeners yourself is that the events fire for the whole tree as 1 item instead of as\n * individual notes.\n *\n * This is particularly useful when you want to track focus leaving or enterring a component\n * without caring about the individual contents inside.\n */\nexport class FocusWatcher {\n    /**\n     * @param rootNode - The root dom node to watch on.\n     * @param callback - A callback for when the tree focuses and blurs.\n     */\n    public constructor(private rootNode: Element, private changeHandler: (hasFocus: boolean) => void) {}\n\n    /**\n     * Register the event listeners from this class.\n     */\n    public start = () => {\n        this.rootNode.addEventListener(\"focusout\", this.handleFocusOut, true);\n        this.rootNode.addEventListener(\"focusin\", this.handleFocusIn, true);\n        document.addEventListener(\"click\", this.handleClick);\n    };\n\n    /**\n     * Remove the event listeners from this class.\n     */\n    public stop = () => {\n        this.rootNode.removeEventListener(\"focusout\", this.handleFocusOut, true);\n        this.rootNode.removeEventListener(\"focusin\", this.handleFocusIn, true);\n        document.removeEventListener(\"click\", this.handleClick);\n    };\n\n    /**\n     * Handle when an element loses focus.\n     */\n    private handleFocusOut = (event: FocusEvent) => {\n        this.checkDomTreeHasFocus(event, this.changeHandler);\n    };\n\n    /**\n     * Handle an element gaining focus.\n     */\n    private handleFocusIn = (event: FocusEvent) => {\n        this.checkDomTreeHasFocus(event, this.changeHandler);\n    };\n\n    /**\n     * Handle an element being clicked.\n     */\n    private handleClick = (event: MouseEvent) => {\n        const triggeringElement = event.target as Element;\n        const wasClicked = this.checkDomTreeWasClicked(triggeringElement);\n        if (!wasClicked) {\n            this.changeHandler(false);\n        }\n    };\n\n    /**\n     * Determine whether or not our DOM tree was clicked.\n     */\n    private checkDomTreeWasClicked(clickedElement: Element) {\n        return (\n            this.rootNode &&\n            clickedElement &&\n            (this.rootNode.contains(clickedElement as Element) || this.rootNode === clickedElement)\n        );\n    }\n\n    /**\n     * Determine if the currently focused element is somewhere inside of (or the same as)\n     * a given Element.\n     *\n     * @param rootNode - The root node to look in.\n     */\n    private checkDomTreeHasFocus(event: FocusEvent, callback: (hasFocus: boolean) => void) {\n        setTimeout(() => {\n            const possibleTargets = [\n                // NEEDS TO COME FIRST, because safari will populate relatedTarget on focusin, and its not what we're looking for.\n                document.activeElement, // IE11, Safari.\n                event.relatedTarget as Element, // Chrome (The actual standard)\n                (event as any).explicitOriginalTarget, // Firefox\n            ];\n\n            let activeElement = null;\n            for (const target of possibleTargets) {\n                if (target && target !== document.body) {\n                    activeElement = target;\n                    break;\n                }\n            }\n\n            if (activeElement !== null) {\n                const hasFocus =\n                    this.rootNode &&\n                    activeElement &&\n                    (activeElement === this.rootNode || this.rootNode.contains(activeElement));\n\n                // We will only invalidate based on something actually getting focus.\n                callback(!!hasFocus);\n            }\n        }, 0);\n    }\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n/**\n * Use the browser's built-in functionality to quickly and safely escape a string.\n *\n * @param str - The string to escape.\n *\n * @returns Escaped HTML.\n */\nexport function escapeHTML(str: string): string {\n    const div = document.createElement(\"div\");\n    div.appendChild(document.createTextNode(str));\n    return div.innerHTML;\n}\n\n/**\n * Use the browser's built-in functionality to quickly unescape a string.\n * UNSAFE with unsafe strings; only use on previously-escaped ones!\n *\n * @param escapedString - A previously escaped string.\n *\n * @returns The unescaped string.\n */\nexport function unescapeHTML(escapedString: string): string {\n    const div = document.createElement(\"div\");\n    div.innerHTML = escapedString;\n    const child = div.childNodes[0];\n    return child && child.nodeValue ? child.nodeValue : \"\";\n}\n\n/**\n * Determine if the browser is escaping the inner contents of our <noscript /> browser.\n */\nexport function browserEscapesNoScript(): boolean {\n    const ns = document.createElement(\"noscript\");\n    ns.innerHTML = \"<test></test>\";\n    document.body.append(ns);\n    const result = ns.innerHTML.startsWith(\"&lt;\");\n    ns.remove();\n    return result;\n}\n\n/**\n * Get an HTML element from a CSS selector or DOM Node.\n *\n * @param selectorOrElement - A CSS selector or an HTML element.\n *\n * @throws If no element was found.\n * @returns An HTMLElement no matter what.\n */\nexport function ensureHtmlElement(selectorOrElement: string | Node | null): HTMLElement {\n    if (typeof selectorOrElement === \"string\") {\n        selectorOrElement = document.querySelector(selectorOrElement);\n    }\n\n    if (!(selectorOrElement instanceof HTMLElement)) {\n        throw new Error(`HTMLElement could not be found for ${selectorOrElement}.`);\n    }\n\n    return selectorOrElement;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n// A weakmap so we can store multiple load callbacks per script.\nconst loadEventCallbacks: WeakMap<Node, Array<(event) => void>> = new WeakMap();\nconst rejectionCache: Map<string, Error> = new Map();\n\n/**\n * Dynamically load a javascript file.\n */\nexport function ensureScript(scriptUrl: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n        const existingScript: HTMLScriptElement | null = document.querySelector(`script[src='${scriptUrl}']`);\n        if (rejectionCache.has(scriptUrl)) {\n            reject(rejectionCache.get(scriptUrl));\n        }\n        if (existingScript && loadEventCallbacks.has(existingScript)) {\n            // Add another resolveCallback into the weakmap.\n            const callbacks = loadEventCallbacks.get(existingScript);\n            callbacks && callbacks.push(resolve);\n        } else {\n            // The script doesn't exist. Lets create it.\n            const head = document.getElementsByTagName(\"head\")[0];\n            const script = document.createElement(\"script\");\n            script.type = \"text/javascript\";\n            script.src = scriptUrl;\n            script.onerror = (event: ErrorEvent) => {\n                const error = new Error(\"Failed to load a required embed script\");\n                rejectionCache.set(scriptUrl, error);\n                reject(error);\n            };\n\n            const timeout = setTimeout(() => {\n                const error = new Error(`Loading of the script ${scriptUrl} has timed out.`);\n                rejectionCache.set(scriptUrl, error);\n                reject(error);\n            }, 10000);\n\n            loadEventCallbacks.set(script, [resolve]);\n\n            script.onload = event => {\n                clearTimeout(timeout);\n                const callbacks = loadEventCallbacks.get(script);\n                callbacks && callbacks.forEach(callback => callback(event));\n                loadEventCallbacks.delete(script);\n            };\n\n            head.appendChild(script);\n        }\n    });\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { browserEscapesNoScript, unescapeHTML } from \"./sanitization\";\n\n/**\n * Prepare an element and it's contents for use in a shadow root.\n *\n * @param element\n * @param cloneElement - If true, clone the element into a `newElementTag`. Preserves CSS classes and IDs.\n *      Particularly useful for when the initial content is inside of a <noscript /> tag.\n * @param newElementTag\n */\nexport function prepareShadowRoot(element: HTMLElement, cloneElement: boolean = false, newElementTag = \"div\") {\n    let html = element.innerHTML;\n    // This is likely a noscript tag.\n    if (browserEscapesNoScript()) {\n        html = unescapeHTML(html);\n    }\n    // Safari escapes the contents of the noscript.\n    if (cloneElement) {\n        const newElement = document.createElement(newElementTag);\n\n        // Clone various attributes.\n        newElement.classList.value = element.classList.value;\n        newElement.id = element.id;\n\n        // Insert the element & remove the old old.\n        element.parentNode!.insertBefore(newElement, element);\n        element.remove();\n        element = newElement;\n    } else {\n        // If we aren't making a new real root, we need to empty it out.\n        // Otherwise we'll have duplicate contents.\n        element.innerHTML = \"\";\n    }\n\n    const shadowHeader = element.attachShadow({ mode: \"open\" });\n    shadowHeader.innerHTML = html;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport tabbable from \"tabbable\";\nimport { logError } from \"@vanilla/utils\";\n\n/**\n * A class for handling tabbing inside of a container with various exclusions.\n *\n * The goal is here is to be able to programatically implement various tabbing behaviours\n * required for accessibility.\n */\nexport class TabHandler {\n    private tabbableElements: HTMLElement[];\n\n    /**\n     * Determine if an element is tabbable.\n     */\n    public static isTabbable(element: Node) {\n        const children = tabbable(element.parentNode);\n        return children.includes(element);\n    }\n\n    /**\n     * Construct the handler. Don't be afraid to construct multiple of these.\n     *\n     * The elements in a particular TabHandler are very moment specific.\n     * If the DOM changes underneath it it will likely no longer be valid.\n     *\n     * @param root - The root element to look in.\n     * @param excludedElements - Elements to ignore.\n     * @param excludedRoots - These element's children will be ignored.\n     */\n    public constructor(\n        root: Element = document.documentElement!,\n        private excludedElements: Element[] = [],\n        private excludedRoots: Element[] = [],\n    ) {\n        this.tabbableElements = tabbable(root);\n    }\n\n    /**\n     * Get the next tabbable item within a given tabindex.\n     *\n     * WARNING: Performance can be poor if you pass many excluded roots and do not\n     * sufficiently narrow the tree your are looking in.\n     *\n     * @param from - The currently focused element.\n     * @param reverse - True to get the previous element instead.\n     * @param allowLooping - Whether or not the focus should loop around from beginning <-> end.\n     */\n    public getNext(\n        from: Element | null = document.activeElement,\n        reverse: boolean = false,\n        allowLooping: boolean = true,\n    ): HTMLElement | null {\n        if (!(from instanceof HTMLElement)) {\n            logError(\"Unable to tab to next element, `fromElement` given is not valid: \", from);\n            return null;\n        }\n        const tabbables = this.tabbableElements.filter(this.createExcludeFilterWithExemption(from));\n        const currentTabIndex = tabbables.indexOf(from);\n\n        if (currentTabIndex < 0) {\n            return null;\n        }\n\n        let targetIndex = reverse ? currentTabIndex - 1 : currentTabIndex + 1;\n\n        if (allowLooping) {\n            // Loop over the beginning and ends\n            if (targetIndex < 0) {\n                targetIndex = tabbables.length - 1;\n            } else if (targetIndex >= tabbables.length) {\n                targetIndex = 0;\n            }\n        }\n\n        return tabbables[targetIndex] || null;\n    }\n\n    /**\n     * Get all.\n     */\n    public getAll(from: Element | null = document.activeElement) {\n        if (!(from instanceof HTMLElement)) {\n            logError(\"Unable to tab to next element, `fromElement` given is not valid: \", from);\n            return null;\n        }\n        return this.tabbableElements.filter(this.createExcludeFilterWithExemption(from));\n    }\n\n    /**\n     * Get the first focusable element.\n     */\n    public getInitial(): HTMLElement | null {\n        const tabbables = this.tabbableElements.filter(this.filterAllExcluded);\n        if (tabbables.length > 0) {\n            return tabbables[0];\n        } else {\n            return null;\n        }\n    }\n    /**\n     * Get the last focusable element.\n     */\n    public getLast(): HTMLElement | null {\n        const tabbables = this.tabbableElements.filter(this.filterAllExcluded);\n        if (tabbables.length > 0) {\n            return tabbables[tabbables.length - 1];\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * Filter out all excluded elements. Allows 1 element and its parents to be exempted.\n     *\n     * The exemption is necessary so we can find our place\n     * if the focus is already in an item that we are trying to exclude.\n     *\n     * @returns A filter for use with [].filter()\n     */\n    private createExcludeFilterWithExemption = (exemption: Element) => {\n        return (elementToFilter: Element): boolean => {\n            const elementIsActiveOrChildOfActive = exemption === elementToFilter || elementToFilter.contains(exemption);\n\n            if (!elementIsActiveOrChildOfActive) {\n                if (this.excludedElements.includes(elementToFilter)) {\n                    return false;\n                }\n                for (const excludedRoot of this.excludedRoots) {\n                    if (excludedRoot !== elementToFilter && excludedRoot.contains(elementToFilter)) {\n                        return false;\n                    }\n                }\n            }\n\n            return true;\n        };\n    };\n\n    /**\n     * A filter for use with [].filter().\n     *\n     * Filters out all excluded elements and roots.\n     */\n    private filterAllExcluded = (elementToFilter: Element): boolean => {\n        if (this.excludedElements.includes(elementToFilter)) {\n            return false;\n        }\n        for (const excludedRoot of this.excludedRoots) {\n            if (excludedRoot !== elementToFilter && excludedRoot.contains(elementToFilter)) {\n                return false;\n            }\n        }\n\n        return true;\n    };\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\n// Some polyfills\nimport \"focus-visible\";\nimport smoothscroll from \"smoothscroll-polyfill\";\n\nsmoothscroll.polyfill();\n\nexport * from \"./domData\";\nexport * from \"./emoji\";\nexport * from \"./EscapeListener\";\nexport * from \"./events\";\nexport * from \"./FocusWatcher\";\nexport * from \"./sanitization\";\nexport * from \"./scripts\";\nexport * from \"./shadowDom\";\nexport * from \"./TabHandler\";\nexport * from \"./visibility\";\n","/**\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport React from \"react\";\n\ninterface IProps {\n    duration: number;\n    onHover: React.MouseEventHandler | undefined;\n    once?: boolean;\n    children: (providedProps: IProvidedProps) => React.ReactNode;\n}\n\ninterface IProvidedProps {\n    onMouseEnter: React.MouseEventHandler;\n    onMouseLeave: React.MouseEventHandler;\n}\n\n/**\n * Component with render props for handling a hover after a certain duration.\n *\n * Simply spread the provided props over the element you want to track the hover of.\n *\n * @example\n * <Hoverable duration={250} onHover={myCallback}>\n *     {providedProps => {\n *          <div {...providedProps} className=\"someClass\">\n *              // Some deeply neested child.\n *          </div>\n *     }}\n * </Hoverable>\n */\nexport class Hoverable extends React.Component<IProps> {\n    public static defaultProps = {\n        once: true,\n    };\n\n    /**\n     * @inheritdoc\n     */\n    public render(): React.ReactNode {\n        return this.props.children({\n            onMouseEnter: this.mouseEnterHandler,\n            onMouseLeave: this.mouseLeaveHandler,\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public componentWillUnmount() {\n        this.dismissTimeout();\n    }\n\n    private hoverTimeout: NodeJS.Timeout;\n    private hasExecuted = false;\n\n    /**\n     * Handle the hover event by checking if we've already called ourselves then calling the passed callback.\n     */\n    private handleHover = (event: React.MouseEvent) => {\n        if (this.hasExecuted && this.props.once) {\n            return;\n        }\n\n        this.hasExecuted = true;\n        if (this.props.onHover) {\n            this.props.onHover(event);\n        }\n    };\n\n    /**\n     * Set a timeout when the mouse enters. If the timeout is not removed we have a hover.\n     */\n    private mouseEnterHandler = (event: React.MouseEvent) => {\n        this.hoverTimeout = setTimeout(() => {\n            this.handleHover(event);\n        }, this.props.duration);\n    };\n\n    /**\n     * Remove the timeout for the hover so it doesn't execute again (or at all).\n     */\n    private mouseLeaveHandler = (event: React.MouseEvent) => {\n        this.dismissTimeout();\n    };\n\n    /**\n     * Cleanup timeouts and properties to reset.\n     */\n    private dismissTimeout() {\n        this.hasExecuted = false;\n        if (this.hoverTimeout) {\n            clearTimeout(this.hoverTimeout);\n        }\n    }\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport ReactDOM from \"react-dom\";\nimport { forceRenderStyles } from \"typestyle\";\n\n/**\n * Mount a root component of a React tree.\n *\n * - ReactDOM render.\n * - Typestyle render.\n *\n * If the overwrite option is passed this component will replace the components you passed as target.\n *\n * Default Mode:\n * <div><TARGET /></div> -> <div><TARGET><REACT></TARGET><div>\n *\n * Overwrite Mode:\n * <div><TARGET /></div> -> <div><REACT/></div>\n */\nexport function mountReact(\n    component: React.ReactElement,\n    target: HTMLElement,\n    callback?: () => void,\n    options?: { overwrite: boolean },\n) {\n    let mountPoint = target;\n    let cleanupContainer: HTMLElement | undefined;\n    if (options && options.overwrite) {\n        const container = document.createElement(\"span\");\n        cleanupContainer = container;\n        target.parentElement!.insertBefore(container, target);\n        mountPoint = container;\n    }\n    ReactDOM.render(component, mountPoint, () => {\n        if (cleanupContainer) {\n            target.remove();\n            if (cleanupContainer.firstElementChild) {\n                cleanupContainer.parentElement!.insertBefore(cleanupContainer.firstElementChild, cleanupContainer);\n                cleanupContainer.remove();\n                target.remove();\n            }\n        }\n        forceRenderStyles();\n        callback && callback();\n    });\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { useEffect } from \"react\";\n\nimport { EscapeListener } from \"@vanilla/dom-utils\";\n\n/**\n * React hook for listening for an escape press on the keyboard inside root element.\n *\n * When escape is pressed, the return element will be focused if provided or the callback will will be called.\n */\nexport function useEscapeListener({\n    root,\n    returnElement,\n    callback,\n}: {\n    root?: HTMLElement | null;\n    returnElement?: HTMLElement | null;\n    callback?: (event: KeyboardEvent) => void;\n}) {\n    useEffect(() => {\n        if (root === null || returnElement === null) {\n            // Bail out if these are null. That means we have unfilled refs. Undefined means they were not passed and we should use the defaults.\n            return;\n        }\n        const actualRoot = root || document.documentElement;\n        const escapeListener = new EscapeListener(actualRoot, returnElement, callback);\n        escapeListener.start();\n        return escapeListener.stop;\n    }, [root, returnElement, callback]);\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { useEffect, useLayoutEffect } from \"react\";\nimport { FocusWatcher } from \"@vanilla/dom-utils\";\n\n/**\n * React hook for creating and destroying a FocusWatcher. See FocusWatcher documentation.\n */\nexport function useFocusWatcher(\n    ref: React.RefObject<Element | null>,\n    changeHandler: (hasFocus: boolean) => void,\n    bypass?: boolean,\n) {\n    useLayoutEffect(() => {\n        if (bypass) {\n            return;\n        }\n        if (ref.current !== null) {\n            const focusWatcher = new FocusWatcher(ref.current, changeHandler);\n            focusWatcher.start();\n            return focusWatcher.stop;\n        }\n    }, [ref, changeHandler, bypass]);\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { RefObject, useState, useLayoutEffect } from \"react\";\nimport ResizeObserver from \"resize-observer-polyfill\";\n\n/**\n * Utility hook for measuring a dom element.\n * Will return back measurements as a bounding rectangle for the element contained in a ref.\n */\nexport function useMeasure(ref: RefObject<HTMLElement | null>) {\n    const [bounds, setContentRect] = useState<DOMRectReadOnly>(\n        // DOMRectReadOnly.fromRect()\n        { x: 0, y: 0, width: 0, height: 0, top: 0, right: 0, bottom: 0, left: 0, toJSON: () => \"\" },\n    );\n\n    useLayoutEffect(() => {\n        let animationFrameId: number | null = null;\n        const measure: ResizeObserverCallback = ([entry]) => {\n            animationFrameId = window.requestAnimationFrame(() => {\n                setContentRect(ref.current!.getBoundingClientRect() as any);\n            });\n        };\n\n        const ro = new ResizeObserver(measure);\n        if (ref.current) {\n            ro.observe(ref.current);\n        }\n\n        return () => {\n            window.cancelAnimationFrame(animationFrameId!);\n            ro.disconnect();\n        };\n    }, [ref]);\n\n    return bounds;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\nimport { useRef, useEffect } from \"react\";\n\n/**\n * Keep a reference to the previous value of something. (during the previous render).\n *\n * @param value\n */\nexport function useLastValue<T>(value: T): T | undefined {\n    const ref = useRef<T>();\n    useEffect(() => void (ref.current = value), [value]);\n    return ref.current;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { useState } from \"react\";\n\n/**\n * Return a throw function for use inside of custom hooks & useEffect.\n *\n * This needed because throwing inside of `useEffect` does not propagate up to error boundaries.\n * @see https://github.com/facebook/react/issues/11334\n */\nexport function useThrowError(): (err: Error) => void {\n    const [error, setError] = useState<Error | null>(null);\n    if (error) {\n        throw error;\n    }\n\n    return setError;\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nexport * from \"./Hoverable\";\nexport * from \"./mounting\";\nexport * from \"./useEscapeListener\";\nexport * from \"./useFocusWatcher\";\nexport * from \"./useMeasure\";\nexport * from \"./useLastValue\";\nexport * from \"./useTabKeyboardHandler\";\nexport * from \"./useThrowError\";\n","/**\n * Utility function related to logging/debugging.\n *\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nlet internalDebugValue = false;\n\n/**\n * Get or set the debug flag.\n *\n * @param newValue - The new value of debug.\n * @returns the current debug setting.\n */\nexport function debug(newValue?: boolean): boolean {\n    if (newValue !== undefined) {\n        internalDebugValue = newValue;\n    }\n\n    return internalDebugValue;\n}\n\n/**\n * Log something to console.\n * This only prints in debug mode.\n *\n * @param value - The value to log.\n */\nexport function logDebug(...value: any[]) {\n    if (internalDebugValue) {\n        // eslint-disable-next-line no-console\n        console.log(...value);\n    }\n}\n\n/**\n * Log an error to console.\n * This will not run in test mode _unless_ debug is set to true.\n *\n * @param value - The value to log.\n */\nexport function logError(...value: any[]) {\n    if (!internalDebugValue && process.env.NODE_ENV === \"test\") {\n        return;\n    }\n    // eslint-disable-next-line no-console\n    console.error(...value);\n}\n\n/**\n * Log a warning to console.\n * This will not run in test mode _unless_ debug is set to true.\n *\n * @param value - The value to log.\n */\nexport function logWarning(...value: any[]) {\n    if (!internalDebugValue && process.env.NODE_ENV === \"test\") {\n        return;\n    }\n    // eslint-disable-next-line no-console\n    console.warn(...value);\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { slugify } from \"@vanilla/utils\";\nimport classNames from \"classnames\";\nimport React, { useCallback, useState } from \"react\";\nimport { inputClasses } from \"@library/forms/inputStyles\";\n\nexport enum InputStyle {\n    DASHBOARD = \"dashboard\",\n    MODERN = \"modern\",\n}\n\nexport enum InputValidationFilter {\n    SLUG = \"slug\",\n    NUMBER = \"number\",\n}\n\ninterface IProps extends React.InputHTMLAttributes<HTMLInputElement> {\n    inputStyle?: InputStyle; // Optionally a style for the input.\n    value?: string; // A value if you want a controlled component. Be sure to use onChange too.\n    validationFilter?: InputValidationFilter; // A live filter to apply.\n    type?: never; // The type is controlled by the component and validationFilter.\n    inputRef?: React.RefObject<HTMLInputElement>;\n}\n\n/**\n * Text input component.\n *\n * Can optionaly take validation filters that will live filter the input.\n */\nexport function TextInput(props: IProps) {\n    const { inputStyle, validationFilter, className, onChange, value, defaultValue, inputRef, ...rest } = props;\n    const [ownValue, setOwnValue] = useState(defaultValue);\n\n    // Get our change handler together.\n    // This will either be a self contained, controlled component (Eg. {@see mountInputs()}).\n    // Or this should be fully controlled by the outer component (takes value and onChange).\n    let actualValue = ownValue;\n    let actualOnChange: React.ChangeEventHandler<HTMLInputElement> | undefined = useCallback(\n        event => {\n            const filterMethod = getFilterMethodForMode(validationFilter);\n            setOwnValue(filterMethod(event.target.value));\n        },\n        [setOwnValue, validationFilter],\n    );\n    if (\"value\" in props) {\n        actualValue = props.value;\n        actualOnChange = props.onChange;\n    }\n\n    // Input type is determined by strictly by the validation filter.\n    const inputType = getInputType(validationFilter);\n    const classes = classNames(\n        className,\n        props.inputStyle === InputStyle.DASHBOARD ? \"form-control\" : inputClasses().text,\n    );\n\n    return (\n        <input\n            {...rest}\n            ref={inputRef}\n            type={inputType}\n            onChange={actualOnChange}\n            value={actualValue}\n            className={classes}\n        />\n    );\n}\n\nfunction getInputType(filterMode?: InputValidationFilter): string {\n    switch (filterMode) {\n        case InputValidationFilter.NUMBER:\n            return \"number\";\n        default:\n            return \"text\";\n    }\n}\n\ntype FilterValidator = (value: string) => string;\n/**\n * Get a filtering function from react.\n *\n * @param filterMode\n */\nfunction getFilterMethodForMode(filterMode?: InputValidationFilter): FilterValidator {\n    switch (filterMode) {\n        case InputValidationFilter.NUMBER:\n            return (value: string) => value.replace(/[^0-9]/g, \"\");\n        case InputValidationFilter.SLUG:\n            return (value: string) => slugify(value, { allowMultipleDashes: true });\n        default:\n            return (value: string) => value;\n    }\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { History } from \"history\";\n\nexport type PageViewHandler = (params: { history: History }) => void | Promise<void>;\nconst handlers: PageViewHandler[] = [];\n\n/**\n * Register a callback for a when a pageview is triggered.\n *\n * @param handler The handler for the page view.\n */\nexport function onPageView(handler: PageViewHandler) {\n    handlers.push(handler);\n}\n\n/**\n * Initialize tracking of the page history and fire the handlers for the current page.\n */\nexport function initPageViewTracking(history: History) {\n    const callHandlers = () => {\n        handlers.forEach(handler => handler({ history }));\n    };\n\n    callHandlers();\n    history.listen(callHandlers);\n}\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache, styleFactory, variableFactory } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { IButtonType } from \"@library/forms/styleHelperButtonInterface\";\nimport { generateButtonStyleProperties } from \"@library/forms/styleHelperButtonGenerator\";\nimport { cssRule } from \"typestyle\";\nimport { colorOut } from \"@library/styles/styleHelpersColors\";\nimport { borders } from \"@library/styles/styleHelpersBorders\";\nimport {\n    absolutePosition,\n    margins,\n    paddings,\n    singleLineEllipsis,\n    unit,\n    userSelect,\n} from \"@library/styles/styleHelpers\";\nimport { calc, percent } from \"csx\";\n\nexport const atMentionVariables = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const makeThemeVars = variableFactory(\"atMention\");\n\n    const font = makeThemeVars(\"font\", {\n        size: globalVars.fonts.size.large,\n    });\n\n    const avatar = makeThemeVars(\"avatar\", {\n        width: 30,\n        margin: 10,\n    });\n\n    const positioning = makeThemeVars(\"positioning\", {\n        offset: 6,\n    });\n\n    // As in the <mark/> tag\n    const mark = makeThemeVars(\"mark\", {\n        weight: globalVars.fonts.weights.semiBold,\n    });\n\n    const link = makeThemeVars(\"link\", {\n        weight: globalVars.fonts.weights.semiBold,\n    });\n\n    const user = makeThemeVars(\"user\", {\n        padding: {\n            vertical: 3,\n            horizontal: 6,\n        },\n    });\n\n    const selected = makeThemeVars(\"selected\", {\n        bg: globalVars.mainColors.bg,\n    });\n\n    const sizing = makeThemeVars(\"sizing\", {\n        width: 200,\n        maxHeight: (avatar.width + user.padding.vertical * 2) * 7.5,\n    });\n\n    return {\n        font,\n        avatar,\n        mark,\n        link,\n        positioning,\n        user,\n        selected,\n        sizing,\n    };\n});\n\nexport const atMentionCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const vars = atMentionVariables();\n    cssRule(\".atMentionList\", {\n        position: \"absolute\",\n        width: unit(vars.sizing.width),\n        transform: `translateY(${unit(vars.positioning.offset)})`,\n    });\n\n    cssRule(\".atMentionList-suggestion\", {\n        ...singleLineEllipsis(),\n        position: \"relative\",\n        appearance: \"none\",\n        border: 0,\n        padding: 0,\n        background: \"none\",\n        width: percent(100),\n        textAlign: \"left\",\n    });\n\n    cssRule(\".atMentionList-items\", {\n        $nest: {\n            \"&.atMentionList-items\": {\n                display: \"block\",\n                ...paddings(vars.user.padding),\n                overflow: \"auto\",\n                maxHeight: unit(vars.sizing.maxHeight),\n            },\n            \"&.isHidden\": {\n                display: \"none\",\n            },\n        },\n    });\n\n    cssRule(\".atMentionList-item\", {\n        $nest: {\n            \"&.atMentionList-item\": {\n                marginBottom: 0,\n            },\n            \"&.isActive .atMentionList-suggestion\": {\n                backgroundColor: colorOut(globalVars.states.focus.color),\n            },\n        },\n    });\n\n    cssRule(\".atMentionList-suggestion\", {\n        width: percent(100),\n        cursor: \"pointer\",\n    });\n\n    cssRule(\".atMentionList-user, .atMentionList-user\", {\n        display: \"flex\",\n        alignItems: \"center\",\n        width: percent(100),\n        boxSizing: \"border-box\",\n        overflow: \"hidden\",\n        lineHeight: unit(vars.avatar.width),\n        ...paddings({\n            vertical: vars.user.padding.vertical,\n            horizontal: vars.user.padding.horizontal,\n        }),\n    });\n\n    cssRule(\".atMentionList-photoWrap\", {\n        marginRight: unit(vars.avatar.margin),\n    });\n\n    cssRule(\".atMentionList-photo\", {\n        width: unit(vars.avatar.width),\n        height: unit(vars.avatar.width),\n    });\n\n    cssRule(\".atMentionList-userName\", {\n        display: \"block\",\n        flexGrow: 1,\n        overflow: \"hidden\",\n        whiteSpace: \"nowrap\",\n        textOverflow: \"ellipsis\",\n        maxWidth: calc(`100% - ${unit(vars.avatar.margin + vars.avatar.width)}`),\n    });\n\n    cssRule(\".atMentionList-mark\", {\n        padding: 0,\n        fontWeight: vars.mark.weight,\n    });\n\n    cssRule(\".atMentionList-photo\", {\n        display: \"block\",\n    });\n\n    cssRule(\".atMention\", {\n        color: \"inherit\",\n        fontWeight: vars.link.weight,\n        userSelect: \"all\",\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache, styleFactory, variableFactory } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { cssRule } from \"typestyle\";\nimport { colorOut } from \"@library/styles/styleHelpersColors\";\nimport { absolutePosition, margins, paddings, unit } from \"@library/styles/styleHelpers\";\nimport { percent } from \"csx\";\n\nexport const accessibilityCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n\n    cssRule(\".accessibility-jumpTo\", {\n        border: unit(0),\n        clip: `rect(0 0 0 0)`,\n        height: unit(1),\n        margin: unit(-1),\n        overflow: \"hidden\",\n        padding: unit(0),\n        position: \"absolute\",\n        width: unit(1),\n        $nest: {\n            \"&:focus\": {\n                position: \"absolute\",\n                top: unit(50),\n                left: unit(0),\n                textAlign: \"left\",\n                backgroundColor: colorOut(globalVars.elementaryColors.white),\n                color: colorOut(globalVars.elementaryColors.black),\n                display: \"block\",\n                fontSize: unit(globalVars.fonts.size.medium),\n                clip: \"auto\",\n                margin: unit(0),\n                height: \"auto\",\n                ...paddings({\n                    vertical: 0,\n                    horizontal: 12,\n                }),\n                width: percent(100),\n                zIndex: 2,\n                transform: `translateY(-100%)`,\n                opacity: 1,\n            },\n            \"&:hover\": {\n                opacity: 1,\n            },\n        },\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache, styleFactory, variableFactory } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { IButtonType } from \"@library/forms/styleHelperButtonInterface\";\nimport { generateButtonStyleProperties } from \"@library/forms/styleHelperButtonGenerator\";\nimport { cssRule } from \"typestyle\";\nimport { colorOut } from \"@library/styles/styleHelpersColors\";\nimport { borders, singleBorder } from \"@library/styles/styleHelpersBorders\";\nimport { absolutePosition, margins, paddings, unit, userSelect } from \"@library/styles/styleHelpers\";\nimport { percent } from \"csx\";\n\nexport const blockQuoteVariables = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const makeThemeVars = variableFactory(\"blockQuote\");\n    const colors = makeThemeVars(\"colors\", {\n        fg: globalVars.mixBgAndFg(0.7),\n        border: {\n            color: globalVars.mixBgAndFg(0.23),\n        },\n    });\n\n    return {\n        colors,\n    };\n});\n\nexport const blockQuoteCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const vars = blockQuoteVariables();\n    cssRule(\".blockquote\", {\n        display: \"block\",\n        margin: unit(0),\n        ...paddings({\n            all: 3,\n            left: 18,\n        }),\n        borderLeft: singleBorder({\n            color: vars.colors.border.color,\n            width: 6,\n        }),\n        boxSizing: \"border-box\",\n        width: percent(100),\n        verticalAlign: \"middle\",\n        color: colorOut(vars.colors.fg),\n    });\n    cssRule(\".blockquote-content\", {\n        $nest: {\n            \"& > *:first-child\": {\n                marginTop: unit(0),\n            },\n            \"& > *:last-child\": {\n                marginBottom: unit(0),\n            },\n        },\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { cssRule } from \"typestyle\";\nimport { em, percent } from \"csx\";\nimport { margins } from \"@library/styles/styleHelpers\";\n\nexport const emojiCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n\n    cssRule(\".safeEmoji\", {\n        display: \"inline-flex\",\n        fontFamily: `\"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", sans-serif`,\n        verticalAlign: \"middle\",\n        textAlign: \"center\",\n        height: em(1),\n        maxWidth: percent(100),\n        lineHeight: em(1),\n    });\n\n    cssRule(\".nativeEmoji\", {\n        fontFamily: `\"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", sans-serif`,\n    });\n\n    cssRule(\".fallBackEmoji\", {\n        display: \"inline-block\",\n        height: em(1),\n        width: em(1),\n        ...margins({\n            vertical: 0,\n            right: em(0.05),\n            left: em(0.1),\n        }),\n        verticalAlign: em(-0.1),\n        userSelect: \"none\",\n    });\n\n    cssRule(\".emojiGroup\", {\n        opacity: globalVars.states.icon.opacity,\n    });\n\n    cssRule(\".emojiPicker\", {\n        position: \"relative\",\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache, styleFactory, variableFactory } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { IButtonType } from \"@library/forms/styleHelperButtonInterface\";\nimport { generateButtonStyleProperties } from \"@library/forms/styleHelperButtonGenerator\";\nimport { cssRule } from \"typestyle\";\nimport { colorOut } from \"@library/styles/styleHelpersColors\";\nimport { borders } from \"@library/styles/styleHelpersBorders\";\nimport { absolutePosition, margins, paddings, unit, userSelect, fonts } from \"@library/styles/styleHelpers\";\nimport { percent } from \"csx\";\nimport { userContentVariables } from \"@library/content/userContentStyles\";\n\nexport const spoilerVariables = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const makeThemeVars = variableFactory(\"spoiler\");\n\n    const font = makeThemeVars(\"font\", {\n        size: globalVars.fonts.size.large,\n    });\n\n    const colors = makeThemeVars(\"colors\", {\n        bg: globalVars.mixBgAndFg(0.95),\n    });\n\n    const borders = makeThemeVars(\"border\", {\n        color: globalVars.border.color,\n        width: 0,\n        radius: 2,\n    });\n\n    const button: IButtonType = makeThemeVars(\"spoilerButton\", {\n        name: \"spoiler\",\n        colors: {\n            bg: globalVars.elementaryColors.transparent,\n        },\n        fonts: {\n            color: globalVars.mainColors.fg,\n        },\n        borders: {\n            width: 0,\n            radius: 0,\n        },\n    } as IButtonType);\n\n    return {\n        font,\n        colors,\n        borders,\n        button,\n    };\n});\n\nexport const spoilerCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const vars = spoilerVariables();\n    const spoilerStyles = generateButtonStyleProperties(vars.button, false);\n    const userContentVars = userContentVariables();\n    cssRule(\".spoiler-icon\", {\n        position: \"relative\",\n        display: \"block\",\n        margin: \"auto\",\n        width: unit(globalVars.icon.sizes.default),\n        height: unit(globalVars.icon.sizes.default),\n        color: colorOut(userContentVars.blocks.fg),\n    });\n    cssRule(\".spoiler\", {\n        backgroundColor: colorOut(userContentVars.blocks.bg),\n        color: colorOut(userContentVars.blocks.fg),\n        border: 0,\n        $nest: {\n            \"& .spoiler-content\": {\n                display: \"none\",\n                ...paddings({\n                    all: globalVars.embed.text.padding,\n                }),\n            },\n            \"& .spoiler-content *:first-child\": {\n                marginTop: 0,\n            },\n            \"& .spoiler-content *:last-child\": {\n                marginBottom: 0,\n            },\n            \"& .spoiler-chevronUp\": {\n                display: \"none\",\n                width: unit(globalVars.icon.sizes.default),\n                height: unit(globalVars.icon.sizes.default),\n                verticalAlign: \".2em\",\n            },\n            \"& .spoiler-chevronDown\": {\n                display: \"none\",\n            },\n            \"&:not(.isShowingSpoiler) .spoiler-chevronDown\": {\n                display: \"inline-block\",\n                width: unit(globalVars.icon.sizes.default),\n                height: unit(globalVars.icon.sizes.default),\n                verticalAlign: \".2em\",\n            },\n            \"&.isShowingSpoiler\": {\n                $nest: {\n                    \"& .spoiler-content\": {\n                        display: \"block\",\n                    },\n                    \"& .spoiler-chevronUp\": {\n                        display: \"inline-block\",\n                    },\n                },\n            },\n            \"& .button-spoiler\": {\n                ...spoilerStyles,\n                ...userSelect(),\n                background: colorOut(userContentVars.blocks.bg),\n                color: colorOut(userContentVars.blocks.fg),\n                width: percent(100),\n                maxWidth: percent(100),\n                fontSize: unit(vars.font.size),\n                minHeight: unit(44),\n                textTransform: \"uppercase\",\n                ...paddings({\n                    vertical: 0,\n                    horizontal: globalVars.embed.text.padding,\n                }),\n                cursor: \"pointer\",\n                textAlign: \"center\",\n            },\n            \"& .button-spoiler:active .spoiler-chevron\": {\n                opacity: 1,\n            },\n            \"& .button-spoiler:not(.focus-visible):focus .spoiler-chevron\": {\n                opacity: 1,\n                outline: 0,\n            },\n            \"& .button-spoiler.focus-visible .spoiler-chevron\": {\n                opacity: 1,\n            },\n            \"& .button-spoiler:hover .spoiler-chevron\": {\n                opacity: 1,\n                cursor: \"pointer\",\n            },\n            \"& .spoiler-warningMain\": {\n                position: \"relative\",\n                display: \"flex\",\n                boxSizing: \"border-box\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                ...paddings({\n                    vertical: 0,\n                    horizontal: globalVars.icon.sizes.default,\n                }),\n                width: percent(100),\n                lineHeight: 1,\n            },\n            \"& .spoiler-chevron\": {\n                ...absolutePosition.middleRightOfParent(globalVars.embed.text.padding),\n                width: unit(globalVars.icon.sizes.default),\n                height: unit(globalVars.icon.sizes.default),\n                display: \"flex\",\n                alignItems: \"center\",\n                opacity: globalVars.states.icon.opacity,\n            },\n            \"& .spoiler-warningLabel\": {\n                ...fonts({\n                    size: globalVars.fonts.size.medium,\n                    weight: globalVars.fonts.weights.semiBold,\n                }),\n                marginLeft: unit(6),\n            },\n            \"& .spoiler-buttonContainer\": {\n                whiteSpace: \"normal\",\n                userSelect: \"none\",\n            },\n        },\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache, styleFactory, variableFactory } from \"@library/styles/styleUtils\";\nimport { globalVariables } from \"@library/styles/globalStyleVars\";\nimport { cssRule } from \"typestyle\";\nimport { colorOut, modifyColorBasedOnLightness } from \"@library/styles/styleHelpersColors\";\nimport { em, percent } from \"csx\";\nimport { paddings } from \"@library/styles/styleHelpersfPadding\";\nimport { userContentVariables } from \"@library/content/userContentStyles\";\n\nexport const codeBlockVariables = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const makeThemeVars = variableFactory(\"blockQuote\");\n\n    const borderRadius = makeThemeVars(\"borderRadius\", {\n        default: 0,\n    });\n\n    const fonts = makeThemeVars(\"fonts\", {\n        size: em(0.85),\n        families: `Menlo, Monaco, Consolas, \"Courier New\", monospace`,\n    });\n\n    const border = makeThemeVars(\"border\", {\n        radius: borderRadius.default,\n    });\n\n    const variablesUserContent = userContentVariables();\n\n    const inline = makeThemeVars(\"inline\", {\n        fg: variablesUserContent.codeInline.fg,\n        bg: variablesUserContent.codeInline.bg,\n        border: {\n            color: globalVars.mixBgAndFg(0.5),\n            radius: 0,\n        },\n        paddings: {\n            vertical: em(0.2),\n            horizontal: em(0.4),\n        },\n    });\n\n    const block = makeThemeVars(\"block\", {\n        fg: variablesUserContent.codeBlock.fg,\n        bg: variablesUserContent.codeBlock.bg,\n        border: {\n            radius: borderRadius.default,\n        },\n        paddings: {\n            all: globalVars.userContent.font.sizes.default,\n        },\n    });\n\n    return {\n        fonts,\n        border,\n        inline,\n        block,\n    };\n});\n\nexport const codeBlockCSS = useThemeCache(() => {\n    const globalVars = globalVariables();\n    const vars = codeBlockVariables();\n    cssRule(\".userContent\", {\n        $nest: {\n            \".code\": {\n                position: \"relative\",\n                display: \"inline\",\n                verticalAlign: \"middle\",\n                lineHeight: \"inherit\",\n                fontSize: vars.fonts.size,\n                fontFamily: vars.fonts.families,\n                maxWidth: percent(100),\n                margin: 0,\n                color: colorOut(vars.inline.fg),\n                backgroundColor: colorOut(vars.inline.bg),\n                border: 0,\n                overflowX: \"auto\",\n                flexShrink: 0,\n            },\n            \".codeInline\": {\n                display: \"inline\",\n                whiteSpace: \"normal\",\n                ...paddings(vars.inline.paddings),\n                borderRadius: vars.inline.border.radius,\n                color: colorOut(vars.inline.fg),\n                backgroundColor: colorOut(vars.inline.bg),\n            },\n            \".codeBlock\": {\n                display: \"block\",\n                wordWrap: \"normal\",\n                lineHeight: globalVars.lineHeights.code,\n                whiteSpace: \"pre\",\n                ...paddings(vars.block.paddings),\n                borderRadius: vars.block.border.radius,\n                color: colorOut(vars.block.fg),\n                backgroundColor: colorOut(vars.block.bg),\n            },\n        },\n    });\n});\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { useThemeCache } from \"@library/styles/styleUtils\";\nimport { cssRule } from \"typestyle\";\nimport { important } from \"csx\";\n\nexport const loadedCSS = useThemeCache(() => {\n    // Avoid FOUC in Forum side\n    cssRule(\"body\", {\n        visibility: important(\"visible\"),\n    });\n});\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { fetchLocalesFromApi } from \"@library/locales/localeActions\";\nimport { setCurrentLocale, loadLocales, loadTranslations } from \"@vanilla/i18n\";\nimport { getMeta } from \"@library/utility/appUtils\";\nimport gdn from \"@library/gdn\";\n\nexport async function bootstrapLocales() {\n    // Fetch the current locale from meta.\n    const currentLocaleValue = getMeta(\"ui.localeKey\", getMeta(\"ui.locale\", null));\n    setCurrentLocale(currentLocaleValue);\n\n    // Register the redux reducer for locales and attempt to fetch them.\n    // They may already be preloaded.\n    const locales = await fetchLocalesFromApi();\n    loadLocales(locales);\n    loadTranslations(gdn.translations);\n}\n","/**\n * Primary bootstrapping of the frontend JS. This entrypoint should be the last once executed.\n *\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { onContent, getMeta, _executeReady } from \"@library/utility/appUtils\";\nimport { logDebug, logError, debug } from \"@vanilla/utils\";\nimport gdn from \"@library/gdn\";\nimport apiv2 from \"@library/apiv2\";\nimport { mountInputs } from \"@library/forms/mountInputs\";\nimport { onPageView } from \"@library/pageViews/pageViewTracking\";\nimport { History } from \"history\";\nimport { _mountComponents } from \"@library/utility/componentRegistry\";\nimport { blotCSS } from \"@rich-editor/quill/components/blotStyles\";\nimport { bootstrapLocales } from \"@library/locales/localeBootstrap\";\n\n// Inject the debug flag into the utility.\nconst debugValue = getMeta(\"context.debug\", getMeta(\"debug\", false));\ndebug(debugValue);\n\nbootstrapLocales();\n\n// Export the API to the global object.\ngdn.apiv2 = apiv2;\n\n// Record the page view.\nonPageView((params: { history: History }) => {\n    void apiv2.post(\"/tick\").then(() => {\n        window.dispatchEvent(new CustomEvent(\"analyticsTick\"));\n    });\n});\n\nlogDebug(\"Bootstrapping\");\n_executeReady()\n    .then(() => {\n        logDebug(\"Bootstrapping complete.\");\n        // Mount all data-react components.\n        onContent(e => {\n            _mountComponents(e.target as HTMLElement);\n            blotCSS();\n            mountInputs();\n        });\n\n        const contentEvent = new CustomEvent(\"X-DOMContentReady\", { bubbles: true, cancelable: false });\n        document.dispatchEvent(contentEvent);\n    })\n    .catch(error => {\n        logError(error);\n    });\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport React from \"react\";\nimport { TextInput, InputValidationFilter } from \"@library/forms/TextInput\";\nimport { mountReact } from \"@vanilla/react-utils\";\nimport { logDebug } from \"@vanilla/utils\";\n\n/**\n * Mount <TextInput /> components on top of <input data-react-input/> elements.\n *\n * If the input has a \"data-validation-filter\" that will be applied as the validationFilter.\n * Ideal for enhancing GDN_Form rendered forms.\n */\nexport function mountInputs() {\n    const inputs = document.querySelectorAll(\"[data-react-input]\");\n    logDebug(`Mounting React inputs over ${inputs.length} existing inputs.`);\n    inputs.forEach(input => {\n        if (input instanceof HTMLInputElement) {\n            const validationFilter = input.getAttribute(\"data-validation-filter\") as InputValidationFilter;\n            mountReact(\n                <TextInput\n                    validationFilter={validationFilter}\n                    defaultValue={input.value}\n                    id={input.id}\n                    className={input.className}\n                    name={input.name}\n                />,\n                input,\n                undefined,\n                { overwrite: true },\n            );\n        }\n    });\n}\n","/*\n * @author Stéphane LaFlèche <stephane.l@vanillaforums.com>\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license Proprietary\n */\n\nimport { atMentionCSS } from \"@rich-editor/quill/components/atMentionStyles\";\nimport { accessibilityCSS } from \"@rich-editor/quill/components/accessibilityStyles\";\nimport { blockQuoteCSS } from \"@rich-editor/quill/components/blockQuoteStyles\";\nimport { emojiCSS } from \"@rich-editor/quill/components/emojiStyles\";\nimport { spoilerCSS } from \"@rich-editor/quill/components/spoilerStyles\";\nimport { codeBlockCSS } from \"@rich-editor/quill/components/codeBlockStyles\";\nimport { loadedCSS } from \"@rich-editor/quill/components/loadedStyles\";\n\nexport const blotCSS = () => {\n    accessibilityCSS();\n    atMentionCSS();\n    blockQuoteCSS();\n    emojiCSS();\n    spoilerCSS();\n    codeBlockCSS();\n    loadedCSS();\n};\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nexport interface ILocale {\n    localeID: string;\n    localeKey: string;\n    regionalKey: string;\n    displayNames: {\n        [localeKey: string]: string;\n    };\n}\n\nlet currentLocale = \"en\";\nlet localeStore: ILocale[] = [];\nlet callbacks: Array<() => void> = [];\n\n/**\n * Get the available locales.\n */\nexport function getLocales(): ILocale[] {\n    return localeStore;\n}\n\n/**\n * Register a handler for if the locales change.\n * @param callback\n */\nexport function onLocaleChange(callback: () => void) {\n    callbacks.push(callback);\n}\n\n/**\n * Set the current locale.\n */\nexport function setCurrentLocale(localeKey: string) {\n    currentLocale = localeKey;\n    callbacks.forEach(callback => callback());\n}\n\n/**\n * Get the current locale.\n */\nexport function getCurrentLocale() {\n    return currentLocale;\n}\n\n/**\n * Load a group of locales.\n */\nexport function loadLocales(locales: ILocale[]) {\n    localeStore = [...localeStore, ...locales];\n    callbacks.forEach(callback => callback());\n}\n\n/**\n * Clear the loaded locales.\n */\nexport function clearLocales() {\n    localeStore = [];\n    callbacks.forEach(callback => callback());\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport { ILocale, getLocales, onLocaleChange, getCurrentLocale } from \"./localeStore\";\nimport { logWarning } from \"@vanilla/utils\";\n\nconst LocaleContext = React.createContext<{\n    locales: ILocale[];\n    currentLocale: string | null;\n}>({\n    locales: [],\n    currentLocale: null,\n});\n\nexport function LocaleProvider(props: { children?: React.ReactNode }) {\n    const [locales, setLocales] = useState(getLocales());\n    const [currentLocale, setCurrentLocale] = useState(getCurrentLocale());\n\n    if (!currentLocale) {\n        logWarning(\"No locale loaded for <LocaleProvider />\");\n    }\n\n    useEffect(() => {\n        setLocales(getLocales());\n        setCurrentLocale(getCurrentLocale());\n\n        onLocaleChange(() => {\n            setLocales(getLocales());\n            setCurrentLocale(getCurrentLocale());\n        });\n    }, [setLocales, setCurrentLocale]);\n\n    return (\n        <LocaleContext.Provider\n            value={{\n                locales,\n                currentLocale,\n            }}\n        >\n            {props.children}\n        </LocaleContext.Provider>\n    );\n}\n\nexport function useLocaleInfo() {\n    return useContext(LocaleContext);\n}\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\ninterface ITranslations {\n    [key: string]: string;\n}\n\nlet translationStore: ITranslations = {};\n\n/**\n * Load a set of key value pairs as translation resources.\n */\nexport function loadTranslations(translations: ITranslations) {\n    translationStore = { ...translations };\n}\n\n/**\n * Clear all translation resources.\n */\nexport function clearTranslations() {\n    translationStore = {};\n}\n\n/**\n * Translate a string into the current locale.\n *\n * @param str - The string to translate.\n * @param defaultTranslation - The default translation to use.\n *\n * @returns Returns the translation or the default.\n */\nexport function translate(str: string, defaultTranslation?: string): string {\n    // Codes that begin with @ are considered literals.\n    if (str.substr(0, 1) === \"@\") {\n        return str.substr(1);\n    }\n\n    if (translationStore[str] !== undefined) {\n        return translationStore[str];\n    }\n\n    return defaultTranslation !== undefined ? defaultTranslation : str;\n}\n\n/**\n * The t function is an alias for translate.\n */\nexport const t = translate;\n","/**\n * @copyright 2009-2019 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nexport * from \"./LocaleDisplayer\";\nexport * from \"./localeStore\";\nexport * from \"./translationStore\";\nexport * from \"./LocaleProvider\";\n","/**\n * Set wepback's public path.\n * Otherwise the lookups of dynamically imported webpack files can fail on sites that have a different webroot\n * Eg. installed in a subfolder / using Reverse Proxy.\n *\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPL-2.0-only\n */\n\nimport { assetUrl } from \"@library/utility/appUtils\";\n\n/**\n * This needs to be a free variable.\n *\n * Webpack does some magic to make this work.\n * It you try and set a local or global version of it, it WILL NOT work.\n *\n * @see https://stackoverflow.com/questions/12934929/what-are-free-variables\n * @see https://webpack.js.org/configuration/output/#output-publicpath\n * @see https://github.com/webpack/webpack/issues/2776#issuecomment-233208623\n */\n// @ts-ignore: Cannot find variable warning. See comment aboe.\n__webpack_public_path__ = assetUrl(\"/dist/\" + __BUILD__SECTION__ + \"/\");\n"],"sourceRoot":""}